#!/bin/bash

gs() {
  if svn info &>/dev/null; then
    svn-color st "$@"
  else
    git config --get remote.origin.url
    git s "$@"
  fi
}

gsv() {
  local files="$(
    if svn info &>/dev/null; then
      command svn st
    else
      git status --short
    fi | sed 's/\s\+/ /g' | cut -d' ' -f2
  )"
  vp "${files[@]}"
}

gl() {
  if svn info &>/dev/null; then
    svn-color log "$@"
  else
    max_lines_to_show="$(tput cols)" git-pretty-log "$@"
  fi
}

gll() {
  if svn info &>/dev/null; then
    svn log | less
  else
    git-pretty-log "$@"
  fi
}

gd() {
  if svn info &>/dev/null; then
    [[ "$(svn diff "$@" 2>/dev/null)" ]] && svn-color diff "$@"
  else
    separator —
    git diff -M "$@"
  fi
}

gdd() {
  if svn info &>/dev/null; then
    sdd "$@"
  else
    git-vimdiff "$@"
  fi
}

ga() {
  if svn info &>/dev/null; then
    svn-color add "$@"
  else
    if [[ $# -eq 0 ]]; then
      git add --all .
    else
      git add --all "$@"
    fi
  fi
  gs .
}

gc() {
  local message="$*"
  if svn info &>/dev/null; then
    svn-color ci -m "$message"
    while ! svn up &>/dev/null; do
      sleep 1
    done
    svn-color log
  else
    git commit -m "$message"
    gl -n "$(( $(tput lines) - 5 ))"
  fi
}

gp() {
  if svn info &>/dev/null; then
    svn-color up
  else
    git pull
  fi
}

g() {
  if svn info &>/dev/null; then
    svn-color "$@"
  else
    git "$@"
  fi
}

gac() {
  git add --all
  gc "$@"
}

gdc() {
  separator —
  g diff --cached -M
}

gin() {
  if svn info &>/dev/null; then
    svn-color info
  else
    git info 2>/dev/null |
    sed "/Type 'git log' for more commits/q" |
    head -n -1
  fi
}

gcl() {
  if svn info &>/dev/null; then
    svn co "$@"
  else
    git clone "$@"
  fi

  separator —
  if [[ "$2" ]]; then
    d "$2"
  else
    d "$(basename "$1" | sed 's/\.git$//')"
  fi
}

grev() {
  if svn info &>/dev/null; then
    if [[ $1 ]]; then
      svn revert -R "$@"
    else
      svn revert -R .
    fi
  else
    git checkout HEAD -- "$@"
  fi
}

alias gca="g c --amend"
alias gad="ga && gdc"
alias gg="gitg"
