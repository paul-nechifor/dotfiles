#!/bin/bash

gs() {
  if git status &>/dev/null; then
    git s "$@"
  else
    svn-color st "$@"
  fi
}

gl() {
  if git status &>/dev/null; then
    max_lines_to_show="$(tput cols)" git-pretty-log "$@"
  else
    svn-color log "$@"
  fi
}

gll() {
  if git status &>/dev/null; then
    git-pretty-log "$@"
  else
    svn log | less
  fi
}

gd() {
  if git status &>/dev/null; then
    separator —
    git diff -M "$@"
  else
    [[ "$(svn diff 2>/dev/null)" ]] && svn-color diff "$@"
  fi
}

gdd() {
  if git status &>/dev/null; then
    git-vimdiff "$@"
  else
    sdd "$@"
  fi
}

ga() {
  if git status &>/dev/null; then
    if [[ $# -eq 0 ]]; then
      git add --all .
    else
      git add --all "$@"
    fi
  else
    svn-color add "$@"
  fi
  gs .
}

gc() {
  local message="$*"
  if git status &>/dev/null; then
    git commit -m "$message"
    gl -n "$(( $(tput lines) - 5 ))"
  else
    svn-color ci -m "$message"
    svn up
    svn-color log
  fi
}

gp() {
  if git status &>/dev/null; then
    git pull
  else
    svn-color up
  fi
}

g() {
  if git status &>/dev/null; then
    git "$@"
  else
    svn-color "$@"
  fi
}

gac() {
  git add --all
  gc "$@"
}

gdc() {
  separator —
  g diff --cached -M
}

gin() {
  if git status &>/dev/null; then
    git info 2>/dev/null |
    sed "/Type 'git log' for more commits/q" |
    head -n -1
  else
    svn-color info
  fi
}

gcl() {
  if git status &>/dev/null; then
    git clone "$@"
  else
    svn co "$@"
  fi

  separator —
  if [[ "$2" ]]; then
    d "$2"
  else
    d "$(basename "$1" | sed 's/\.git$//')"
  fi
}

grev() {
  if git status &>/dev/null; then
    git checkout HEAD -- "$@"
  else
    if [[ $1 ]]; then
      svn revert -R "$@"
    else
      svn revert -R .
    fi
  fi
}

alias gca="g c --amend"
alias gad="ga && gdc"
alias gg="gitg"
